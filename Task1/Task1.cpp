#include "morse_translator.h"
#include <iostream>
#include <fcntl.h>

/**
 * @brief Программа-телеграф: переводит русское сообщение в азбуку Морзе.
 *
 * Использует широкие строки и потоки для поддержки Юникода и русской локали.
 * Поддерживаются буквы русского алфавита (верхний и нижний регистр), пробелы между словами.
 * Прочие символы игнорируются.
 *
 * Разделение:
 * - Буквы разделяются одним пробелом
 * - Слова разделяются символом `/`
 *
 * @return int Код завершения программы (0 - успешно)
 */
int main() {
    std::setlocale(LC_ALL, "");

    _setmode(_fileno(stdout), _O_U16TEXT);

    const std::map<wchar_t, std::wstring> morse = {
            {L'А', L".-"},    {L'Б', L"-..."},  {L'В', L".--"},   {L'Г', L"--."},
            {L'Д', L"-.."},   {L'Е', L"."},     {L'Ж', L"...-"},  {L'З', L"--.."},
            {L'И', L".."},    {L'Й', L".---"},  {L'К', L"-.-"},   {L'Л', L".-.."},
            {L'М', L"--"},    {L'Н', L"-."},    {L'О', L"---"},   {L'П', L".--."},
            {L'Р', L".-."},   {L'С', L"..."},   {L'Т', L"-"},     {L'У', L"..-"},
            {L'Ф', L"..-."},  {L'Х', L"...."},  {L'Ц', L"-.-."},  {L'Ч', L"---."},
            {L'Ш', L"----"},  {L'Щ', L"--.-"},  {L'Ъ', L".--.-."},{L'Ы', L"-.--"},
            {L'Ь', L"-..-"},  {L'Э', L"..-.."}, {L'Ю', L"..--"},  {L'Я', L".-."}
    };

    std::wcout << L"Введите сообщение на русском языке: ";
    std::wstring message = L"";

    if (!std::getline(std::wcin, message)) {
        std::wcerr << L"Ошибка чтения ввода." << std::endl;
        return 1;
    }

    if (message.empty()) {
        std::wcout << L"Ввод пустой. Сообщение не будет переведено." << std::endl;
        return 0;
    }

    std::wcout << L"Сообщение в азбуке Морзе:\n";

    translate_to_morse(message, morse);

    std::wcout << std::endl;
    return 0;
}